import urllib.parse
from datetime import datetime


def create_google_calendar_url(title, description, date_str):
    """ç”Ÿæˆ Google Calendar æ·»åŠ é“¾æ¥"""
    # é»˜è®¤è®¾ä¸ºå½“å¤©å…¨å¤©äº‹ä»¶ï¼Œæˆ–è€…è®¾ä¸ºä¸Šåˆ 9 ç‚¹æé†’
    try:
        dt = datetime.strptime(date_str, "%Y-%m-%d")
        # æ ¼å¼: YYYYMMDDT090000Z
        start_time = dt.strftime("%Y%m%dT090000")
        end_time = dt.strftime("%Y%m%dT100000")
    except:
        return "#"

    base_url = "https://calendar.google.com/calendar/render"
    params = {
        "action": "TEMPLATE",
        "text": f"ğŸ’³ Walle Reminder: {title}",
        "details": f"{description}\n\nGenerated by Walle AI.",
        "dates": f"{start_time}/{end_time}",
    }
    return f"{base_url}?{urllib.parse.urlencode(params)}"


def create_ics_file_content(title, description, date_str):
    """ç”Ÿæˆ .ics æ–‡ä»¶å†…å®¹ (é€‚é… Apple / Outlook)"""
    try:
        dt = datetime.strptime(date_str, "%Y-%m-%d")
        dt_str = dt.strftime("%Y%m%d")
    except:
        dt_str = datetime.now().strftime("%Y%m%d")

    # ICS æ ‡å‡†æ ¼å¼
    ics_content = f"""BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Walle AI//Credit Card Agent//EN
BEGIN:VEVENT
SUMMARY:ğŸ’³ Walle Reminder: {title}
DTSTART;VALUE=DATE:{dt_str}
DTEND;VALUE=DATE:{dt_str}
DESCRIPTION:{description}
STATUS:CONFIRMED
SEQUENCE:0
BEGIN:VALARM
TRIGGER:-PT9H
DESCRIPTION:Reminder
ACTION:DISPLAY
END:VALARM
END:VEVENT
END:VCALENDAR"""
    return ics_content
